{% extends 'layout.html.twig' %}

{% block layout_title %}API Documentation{% endblock %}

{% block content %}

    <h2 class="mb-4">Get Token</h2>
    <div class="container">
        <form id="getTokenForm">
            <div class="row mb-3">

                <div class="col">
                    <!-- Hidden input for Username -->
                    <input type="hidden" id="username" name="username" value="{{ app.user ? app.user.email : '' }}">
                </div>

                <div class="col">
                    <!-- Password input field -->
                    <input type="password" id="password" name="password" class="form-control" placeholder="Enter password" required>
                </div>

                <div class="col align-self-end">
                    <!-- Submit button -->
                    <button type="submit" class="btn btn-primary">Get Token</button>
                </div>

                <div class="col">
                        <!-- Result input field -->
                    <input type="text" id="tokenResult" class="form-control" readonly>
                </div>


                <div class="col align-self-end">
                    <!-- Copy button -->
                    <button onclick="copyToken()" class="btn btn-primary">Copy</button>
                </div>
            </div>
        </form>
    </div>

    <div style="margin-bottom: 100px;"></div>

    <h2>API Documentation</h2>
    <div id="api-documentation">
        {# Use the iframe to display the Swagger UI. An iframe is an element that allows embedding other websites or documents into the current page. #}
        <iframe src="{{ path('app.swagger_ui') }}" width="100%" height="2000">
            Your browser does not support iframes. Please <a href="{{ path('app.swagger_ui') }}">click here</a> to view the API documentation.
        </iframe>
    </div>


{% endblock %}


    {% block javascripts %}
    {{ parent() }}

        <script>
            // Get the token from the API
            document.getElementById("getTokenForm").addEventListener("submit", function(event) {
                event.preventDefault();
                const formData = new FormData(event.target);
                const username = formData.get("username");
                const password = formData.get("password");
                fetch('/api/login_check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password }),
                })
                    .then(response => response.json())
                    .then(data => {
                        if(data.token) {
                            // Set the token in the input box
                            document.getElementById("tokenResult").value = data.token;
                        } else {
                            document.getElementById("tokenResult").value = 'Error: Token not generated.';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById("tokenResult").value = `Error: ${error.toString()}`;
                    });
            });

            // Copy the token to the clipboard
            function copyToken() {
                var copyText = document.getElementById("tokenResult").value;

                // Using the Clipboard API to copy text
                navigator.clipboard.writeText(copyText).then(function() {

                }, function(err) {
                    // Error handling
                    console.error('Could not copy text: ', err);
                });
            }

        </script>

    {% endblock %}